# 📝 未实现协议TODO列表

**生成时间**: 2025-09-17
**项目路径**: /Users/mini/Documents/GitHub/wfunc/slot-game

## 🚨 优先级说明

- 🔴 **P0 - 紧急**: 影响核心功能，必须立即实现
- 🟡 **P1 - 高**: 重要功能，应尽快实现
- 🟢 **P2 - 中**: 增强功能，计划内实现
- ⚪ **P3 - 低**: 可选功能，有时间再实现

## 🔴 P0 - 紧急任务 (3个)

### 1. 实现心跳机制
- [ ] **协议ID**: 2099
- [ ] **协议名**: m_2099_tos/toc
- [ ] **功能**: 心跳包
- [ ] **实现位置**: 创建 `/internal/websocket/config_handler.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - 客户端定期发送心跳请求
  - 服务端响应并更新连接活跃时间
  - 超时自动断开僵尸连接

### 2. 实现配置获取
- [ ] **协议ID**: 2001
- [ ] **协议名**: m_2001_tos/toc
- [ ] **功能**: 获取信息（用户ID、余额等）
- [ ] **实现位置**: `/internal/websocket/config_handler.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - 返回用户基本信息
  - 返回当前余额
  - 可扩展其他配置信息

### 3. 实现错误捕获
- [ ] **协议ID**: 2002
- [ ] **协议名**: m_2002_tos/toc
- [ ] **功能**: 捕捉错误
- [ ] **实现位置**: `/internal/websocket/config_handler.go`
- [ ] **工作量**: 1小时
- [ ] **实现要点**:
  - 接收客户端错误报告
  - 记录到日志系统
  - 可选：错误统计分析

## 🟡 P1 - 高优先级 (5个)

### 4. 实现彩金推送
- [ ] **协议ID**: 1810
- [ ] **协议名**: m_1810_toc
- [ ] **功能**: 推送彩金
- [ ] **实现位置**: `/internal/game/animal/manager.go`
- [ ] **工作量**: 3小时
- [ ] **实现要点**:
  - 彩金累计逻辑
  - 定时推送机制
  - 彩金池管理

### 5. 实现彩金中奖
- [ ] **协议ID**: 1811
- [ ] **协议名**: m_1811_toc
- [ ] **功能**: 推送彩金中奖
- [ ] **实现位置**: `/internal/game/animal/manager.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - 中奖条件判定
  - 中奖金额计算
  - 推送给所有玩家

### 6. 实现彩金记录
- [ ] **协议ID**: 1812
- [ ] **协议名**: m_1812_tos/toc
- [ ] **功能**: 彩金记录查询
- [ ] **实现位置**: `/internal/websocket/animal_handler.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - 数据库表设计
  - 记录查询接口
  - 分页支持

### 7. 实现JP推送
- [ ] **协议ID**: 1904
- [ ] **协议名**: m_1904_toc
- [ ] **功能**: 推送中JP
- [ ] **实现位置**: `/internal/websocket/slot_handler.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - JP中奖判定
  - 广播给所有玩家
  - JP池更新

### 8. 实现游戏切换
- [ ] **协议ID**: 9901
- [ ] **协议名**: m_9901_toc
- [ ] **功能**: 游戏切换通知
- [ ] **实现位置**: 创建 `/internal/websocket/bridge_handler.go`
- [ ] **工作量**: 3小时
- [ ] **实现要点**:
  - 游戏状态保存
  - 切换类型处理
  - 数据桥接

## 🟢 P2 - 中优先级 (14个)

### Animal游戏活动场功能

#### 9. 进入活动游戏
- [ ] **协议ID**: 1871
- [ ] **协议名**: m_1871_tos/toc
- [ ] **功能**: 进入活动场
- [ ] **工作量**: 4小时

#### 10. 活动场打动物
- [ ] **协议ID**: 1872
- [ ] **协议名**: m_1872_tos/toc
- [ ] **功能**: 活动场内打动物
- [ ] **工作量**: 3小时

#### 11. 获取排行榜
- [ ] **协议ID**: 1873
- [ ] **协议名**: m_1873_tos/toc
- [ ] **功能**: 查询活动排行榜
- [ ] **工作量**: 2小时

#### 12. 活动场动物离开
- [ ] **协议ID**: 1874
- [ ] **协议名**: m_1874_toc
- [ ] **功能**: 推送动物离开（活动场）
- [ ] **工作量**: 1小时

#### 13. 活动结束
- [ ] **协议ID**: 1875
- [ ] **协议名**: m_1875_toc
- [ ] **功能**: 活动结束玩家退出
- [ ] **工作量**: 2小时

#### 14. 活动场动物进入
- [ ] **协议ID**: 1876
- [ ] **协议名**: m_1876_toc
- [ ] **功能**: 推送动物进来（活动场）
- [ ] **工作量**: 1小时

#### 15. 活动场动物死亡
- [ ] **协议ID**: 1877
- [ ] **协议名**: m_1877_toc
- [ ] **功能**: 推送动物被打死（活动场）
- [ ] **工作量**: 2小时

#### 16. 活动状态推送
- [ ] **协议ID**: 1878
- [ ] **协议名**: m_1878_toc
- [ ] **功能**: 推送活动状态
- [ ] **工作量**: 1小时

#### 17. 观战视角
- [ ] **协议ID**: 1879
- [ ] **协议名**: m_1879_tos/toc
- [ ] **功能**: 观战视角进入
- [ ] **工作量**: 3小时

#### 18. 排行推送
- [ ] **协议ID**: 1880
- [ ] **协议名**: m_1880_toc
- [ ] **功能**: 推送排行
- [ ] **工作量**: 1小时

#### 19. 点击推送
- [ ] **协议ID**: 1881
- [ ] **协议名**: m_1881_toc
- [ ] **功能**: 推送点击
- [ ] **工作量**: 1小时

#### 20. 活动广播
- [ ] **协议ID**: 1889
- [ ] **协议名**: m_1889_toc
- [ ] **功能**: 推送广播
- [ ] **工作量**: 2小时

### 技能增强功能

#### 21. 一击必杀显示
- [ ] **协议ID**: 1813
- [ ] **协议名**: m_1813_toc
- [ ] **功能**: 推送玩家头像显示一击必杀
- [ ] **工作量**: 2小时

#### 22. 清除一击必杀
- [ ] **协议ID**: 1814
- [ ] **协议名**: m_1814_toc
- [ ] **功能**: 清除玩家头像显示一击必杀
- [ ] **工作量**: 1小时

## ⚪ P3 - 低优先级 (1个)

### 23. 游戏返回通知
- [ ] **协议ID**: 9902
- [ ] **协议名**: m_9902_toc
- [ ] **功能**: 游戏返回通知
- [ ] **实现位置**: `/internal/websocket/bridge_handler.go`
- [ ] **工作量**: 2小时
- [ ] **实现要点**:
  - 返回数据处理
  - 状态恢复
  - 结果统计

## 📊 实现进度统计

| 优先级 | 待实现 | 预估工时 | 建议完成时间 |
|--------|--------|----------|-------------|
| P0 | 3 | 5小时 | 1天内 |
| P1 | 5 | 12小时 | 3天内 |
| P2 | 14 | 28小时 | 2周内 |
| P3 | 1 | 2小时 | 1月内 |
| **总计** | **23** | **47小时** | - |

## 🛠️ 实现建议

### 第一阶段（本周）
1. 创建`config_handler.go`实现所有Config协议
2. 实现心跳机制确保连接稳定性
3. 完成彩金系统基础功能

### 第二阶段（下周）
1. 实现活动场核心功能
2. 完善游戏间切换机制
3. 增强技能显示效果

### 第三阶段（后续）
1. 完善活动场所有功能
2. 优化推送机制
3. 性能测试和调优

## 📋 代码模板

### Config Handler模板
```go
// internal/websocket/config_handler.go
package websocket

import (
    "github.com/gorilla/websocket"
    "github.com/wfunc/slot-game/internal/pb"
    "google.golang.org/protobuf/proto"
)

type ConfigHandler struct {
    // 实现配置相关协议处理
}

func (h *ConfigHandler) HandleMessage(conn *websocket.Conn, msgID uint16, data []byte) {
    switch msgID {
    case 2001: // 获取信息
        h.handleGetInfo(conn, data)
    case 2002: // 捕捉错误
        h.handleCatchError(conn, data)
    case 2099: // 心跳
        h.handleHeartbeat(conn, data)
    }
}
```

### 活动场Manager模板
```go
// internal/game/animal/activity_manager.go
package animal

type ActivityManager struct {
    rooms map[uint32]*ActivityRoom
    // 活动场管理逻辑
}

type ActivityRoom struct {
    players map[uint32]*Player
    animals map[uint32]*Animal
    ranking []*RankInfo
    state   ActivityState
}
```

## ✅ 完成标准

每个协议实现需满足：
1. ✅ 协议编解码正确
2. ✅ 业务逻辑完整
3. ✅ 错误处理完善
4. ✅ 日志记录充分
5. ✅ 单元测试覆盖
6. ✅ 文档更新

---

*TODO列表生成完成，请按优先级逐步实现*