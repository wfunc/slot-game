# ACMè¿æ¥æˆåŠŸæŒ‡å—

## âœ… é—®é¢˜å·²å®šä½

é€šè¿‡æµ‹è¯•å·¥å…·éªŒè¯ï¼ŒACMè®¾å¤‡å·¥ä½œæ­£å¸¸ï¼š
- è®¾å¤‡è·¯å¾„ï¼š`/dev/ttyACM0`
- é…ç½®ï¼š115200æ³¢ç‰¹ç‡ï¼Œ8N2ï¼ˆ8æ•°æ®ä½ï¼Œæ— æ ¡éªŒï¼Œ2åœæ­¢ä½ï¼‰
- å‘½ä»¤æ ¼å¼ï¼š`algo -b 1 -p 100`
- å“åº”æ ¼å¼ï¼šJSON

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. ä¸²å£é…ç½®
- ç¡®è®¤ä½¿ç”¨8N2é…ç½®ï¼ˆä¸æµ‹è¯•å·¥å…·ä¸€è‡´ï¼‰
- å›ºå®šReadTimeoutä¸º100ms
- ç§»é™¤å¯èƒ½å¯¼è‡´é—®é¢˜çš„Flushè°ƒç”¨

### 2. åˆå§‹åŒ–åºåˆ—
- å»¶é•¿ç­‰å¾…æ—¶é—´åˆ°500msè®©è®¾å¤‡å®Œå…¨å°±ç»ª
- ä½¿ç”¨verå‘½ä»¤ä»£æ›¿helpä½œä¸ºåˆå§‹æµ‹è¯•
- è¿æ¥åæ¸…ç©ºç¼“å†²åŒº

### 3. æ¶ˆæ¯å¤„ç†
- æ­£ç¡®è·³è¿‡"end"å’Œ">"æ ‡è®°
- è¯†åˆ«å¹¶è®°å½•JSONå“åº”
- æ”¹è¿›é”™è¯¯æ¶ˆæ¯å¤„ç†

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

```bash
# 1. å¤åˆ¶æ–°ç‰ˆæœ¬
scp release/slot-game-arm64.tar.gz sg@<è®¾å¤‡IP>:/tmp/

# 2. SSHç™»å½•
ssh sg@<è®¾å¤‡IP>

# 3. åœæ­¢æœåŠ¡
sudo systemctl stop slot-game

# 4. å®‰è£…
cd /tmp
tar -xzf slot-game-arm64.tar.gz
cd slot-game-arm64
sudo ./install.sh

# 5. é‡å¯æœåŠ¡
sudo systemctl restart slot-game

# 6. æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u slot-game -f
```

## ğŸ¯ é¢„æœŸæ—¥å¿—

æˆåŠŸè¿æ¥ååº”è¯¥çœ‹åˆ°ï¼š
```
ACMæ§åˆ¶å™¨å·²è¿æ¥ port=/dev/ttyACM0 baudrate=115200 config=8N2
å‘é€æµ‹è¯•å‘½ä»¤
ACM JSONå“åº” message={"code":0,"msg":"success"...}
Algoå®šæ—¶å™¨å·²å¯åŠ¨ interval=5s
å®šæ—¶algoå‘½ä»¤å“åº” response={...}
```

## ğŸ“Š ACMè®¾å¤‡è¡Œä¸º

ä»æµ‹è¯•å·¥å…·è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼š
1. **ç¬¬ä¸€æ¬¡å‘½ä»¤å¯èƒ½å¤±è´¥**ï¼šè¿”å›"Command not recognised"
2. **ç¬¬äºŒæ¬¡å¼€å§‹æ­£å¸¸**ï¼šè¿”å›JSONæ ¼å¼çš„å“åº”
3. **å“åº”æ ¼å¼**ï¼š
   ```json
   {
     "code": 0,
     "msg": "success",
     "ident": 47,
     "function": "algo",
     "prize": 0,
     "bet": 1,
     "algo": {...},
     "win": 0.0000,
     "chk": "..."
   }
   ```
4. **ç»“æŸæ ‡è®°**ï¼šæ¯ä¸ªå“åº”åæœ‰"end"å’Œ">"

## ğŸ” éªŒè¯è¿æ¥

```bash
# 1. æ£€æŸ¥ä¸²å£æ˜¯å¦è¢«å ç”¨
lsof /dev/ttyACM0

# 2. æŸ¥çœ‹ACMç›¸å…³æ—¥å¿—
sudo journalctl -u slot-game | grep ACM

# 3. æŸ¥çœ‹algoå‘½ä»¤å“åº”
sudo journalctl -u slot-game | grep "algoå‘½ä»¤å“åº”"

# 4. æ£€æŸ¥æ˜¯å¦æœ‰EOFé”™è¯¯
sudo journalctl -u slot-game | grep EOF
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è®¾å¤‡åˆå§‹åŒ–**ï¼šACMè®¾å¤‡éœ€è¦æ—¶é—´åˆå§‹åŒ–ï¼Œä¸è¦å¤ªå¿«å‘é€å‘½ä»¤
2. **é”™è¯¯å¤„ç†**ï¼šç¬¬ä¸€ä¸ªå‘½ä»¤å¯èƒ½å¤±è´¥æ˜¯æ­£å¸¸çš„
3. **å®šæ—¶å™¨é—´éš”**ï¼šå»ºè®®algoå®šæ—¶å™¨é—´éš”ä¸è¦å¤ªçŸ­ï¼ˆ>=5ç§’ï¼‰

## ğŸ“ é…ç½®æ–‡ä»¶ç¡®è®¤

```yaml
serial:
  enabled: true
  
  acm:
    enabled: true
    port: "auto"  # æˆ–æŒ‡å®š "/dev/ttyACM0"
    baud_rate: 115200
    algo_timer_enabled: true
    algo_timer_interval: 5s
    algo_bet: 1
    algo_prize: 100
```

## ğŸš€ æµ‹è¯•å‘½ä»¤

éƒ¨ç½²åå¯ä»¥ç”¨æµ‹è¯•å·¥å…·éªŒè¯ï¼š
```bash
/home/ztl/tools/serial_tester_linux_arm -d /dev/ttyACM0
```

å¦‚æœslot-gameæ­£åœ¨è¿è¡Œï¼Œæµ‹è¯•å·¥å…·ä¼šæ˜¾ç¤ºè®¾å¤‡è¢«å ç”¨ï¼Œè¿™è¯´æ˜è¿æ¥æˆåŠŸã€‚