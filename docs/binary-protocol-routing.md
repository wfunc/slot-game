# äºŒè¿›åˆ¶åè®®è·¯ç”±ç³»ç»Ÿ

## ðŸ“ æ¦‚è¿°

ç³»ç»ŸçŽ°åœ¨æ”¯æŒå°†å‰ç«¯çš„äºŒè¿›åˆ¶åè®®è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„æ¸¸æˆå¤„ç†å™¨ï¼Œå®žçŽ°äº†åè®®çš„ç»Ÿä¸€ç®¡ç†å’Œåˆ†å‘ã€‚

## ðŸ”Œ WebSocket ç«¯ç‚¹

```
ws://localhost:8080/ws/binary
```

## ðŸŽ¯ å‘½ä»¤è·¯ç”±è§„åˆ™

| å‘½ä»¤èŒƒå›´ | å¤„ç†å™¨ | è¯´æ˜Ž |
|----------|--------|------|
| 1800-1899 | AnimalHandler | åŠ¨ç‰©æ¸¸æˆç›¸å…³å‘½ä»¤ |
| 1900-1999 | SlotHandler | è€è™Žæœºæ¸¸æˆç›¸å…³å‘½ä»¤ |
| 2000-2099 | ConfigHandler | é…ç½®ç›¸å…³å‘½ä»¤ |
| 1002 | HeartbeatHandler | å¿ƒè·³å‘½ä»¤ |

## ðŸ“Š å…·ä½“å‘½ä»¤æ˜ å°„

### Slotæ¸¸æˆå‘½ä»¤ (1900-1999)
- `1901` - è¿›å…¥æˆ¿é—´
- `1902` - å¼€å§‹æ¸¸æˆ
- `1903` - æ‰§è¡Œè½¬åŠ¨
- `1904` - å½©é‡‘æŽ¨é€
- `1905` - æ¸¸æˆç»“ç®—

### Animalæ¸¸æˆå‘½ä»¤ (1800-1899)
- `1801` - è¿›å…¥åŠ¨ç‰©å›­
- `1802` - ä¸‹æ³¨
- `1803` - å¼€å§‹æ¸¸æˆ
- `1804` - æ¸¸æˆç»“æžœ
- `1805` - é€€å‡ºæ¸¸æˆ

### é…ç½®å‘½ä»¤ (2000-2099)
- `2001` - èŽ·å–æ¸¸æˆé…ç½®
- `2002` - æ›´æ–°é…ç½®
- `2099` - ç‰¹æ®Šé…ç½®æŸ¥è¯¢ï¼ˆè¿”å›žç©ºæˆåŠŸå“åº”ï¼‰

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

```
å‰ç«¯ (JavaScript)
    â†“ [äºŒè¿›åˆ¶åè®®: 9å­—èŠ‚å¤´ + æ•°æ®]
/ws/binary ç«¯ç‚¹
    â†“
BinaryWebSocketHandler
    â†“
ProtocolClient (åè®®è§£æž)
    â†“
BinaryProtocolRouter (è·¯ç”±åˆ†å‘)
    â”œâ”€â”€ SlotHandler (1900-1999)
    â”œâ”€â”€ AnimalHandler (1800-1899)
    â””â”€â”€ ConfigHandler (2000-2099)
```

## ðŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯å‘é€ Slot æ¸¸æˆå‘½ä»¤
```javascript
// å‘é€1901å‘½ä»¤ - è¿›å…¥æˆ¿é—´
sendMessage(1901, flag, {room_type: "normal"});

// æœåŠ¡ç«¯è‡ªåŠ¨è·¯ç”±åˆ° SlotHandler
// è¿”å›žï¼š{"status":"success","room_id":1,"game":"slot"}
```

### å‰ç«¯å‘é€ Animal æ¸¸æˆå‘½ä»¤
```javascript
// å‘é€1801å‘½ä»¤ - è¿›å…¥åŠ¨ç‰©å›­
sendMessage(1801, flag, {zoo_type: 1});

// æœåŠ¡ç«¯è‡ªåŠ¨è·¯ç”±åˆ° AnimalHandler
// è¿”å›žï¼š{"status":"success","game":"animal"}
```

### å‰ç«¯å‘é€é…ç½®å‘½ä»¤
```javascript
// å‘é€2099å‘½ä»¤ - é…ç½®æŸ¥è¯¢
sendMessage(2099, flag, {});

// æœåŠ¡ç«¯è¿”å›žç©ºçš„æˆåŠŸå“åº”ï¼ˆErrorID=0, æ— æ•°æ®ï¼‰
// è¿™æ ·å‰ç«¯ä¸ä¼šæŠ¥é”™
```

## ðŸ”§ æ ¸å¿ƒç»„ä»¶

### BinaryProtocolRouter
- **ä½œç”¨**: æ¶ˆæ¯è·¯ç”±ä¸­å¿ƒ
- **èŒè´£**: æ ¹æ®å‘½ä»¤IDåˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨
- **æ–‡ä»¶**: `/internal/websocket/binary_protocol_router.go`

### è·¯ç”±é€»è¾‘
```go
switch {
case msg.Cmd >= 1900 && msg.Cmd < 2000:
    // è·¯ç”±åˆ° SlotHandler
case msg.Cmd >= 1800 && msg.Cmd < 1900:
    // è·¯ç”±åˆ° AnimalHandler
case msg.Cmd >= 2000 && msg.Cmd < 2100:
    // è·¯ç”±åˆ° ConfigHandler
case msg.Cmd == 1002:
    // å¤„ç†å¿ƒè·³
default:
    // è¿”å›žæœªçŸ¥å‘½ä»¤é”™è¯¯
}
```

## âœ¨ ç‰¹æ€§

1. **è‡ªåŠ¨è·¯ç”±**: æ ¹æ®å‘½ä»¤IDè‡ªåŠ¨åˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨
2. **åè®®è½¬æ¢**: æ”¯æŒå‰ç«¯äºŒè¿›åˆ¶åè®®ä¸Žå†…éƒ¨protobufåè®®çš„è½¬æ¢
3. **é”™è¯¯å¤„ç†**: å¯¹æœªçŸ¥å‘½ä»¤è¿”å›žå‹å¥½çš„é”™è¯¯å“åº”
4. **è°ƒè¯•æ”¯æŒ**: è¯¦ç»†çš„æ—¥å¿—è®°å½•æ¯ä¸ªæ¶ˆæ¯çš„è·¯ç”±è¿‡ç¨‹
5. **æ‰©å±•æ€§å¼º**: è½»æ¾æ·»åŠ æ–°çš„å‘½ä»¤èŒƒå›´å’Œå¤„ç†å™¨

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **å‘½ä»¤IDè§„åˆ’**: ç¡®ä¿ä¸åŒæ¸¸æˆçš„å‘½ä»¤IDä¸é‡å 
2. **é”™è¯¯ç çº¦å®š**: ErrorID=0 è¡¨ç¤ºæˆåŠŸï¼Œéžé›¶è¡¨ç¤ºé”™è¯¯
3. **æ•°æ®æ ¼å¼**: Dataå­—æ®µé€šå¸¸ä½¿ç”¨JSONæ ¼å¼
4. **å¿ƒè·³æœºåˆ¶**: å»ºè®®æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³(Cmd=1002)

## ðŸš€ åŽç»­ä¼˜åŒ–

1. **å®Œæ•´é›†æˆ**: å°†SlotHandlerå’ŒAnimalHandlerçš„çœŸå®žé€»è¾‘é›†æˆ
2. **åè®®æ¡¥æŽ¥**: å®žçŽ°äºŒè¿›åˆ¶åè®®åˆ°protobufçš„å®Œæ•´è½¬æ¢
3. **çŠ¶æ€ç®¡ç†**: æ·»åŠ ç”¨æˆ·ä¼šè¯å’Œæ¸¸æˆçŠ¶æ€ç®¡ç†
4. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨å¯¹è±¡æ± å‡å°‘å†…å­˜åˆ†é…

---
*æ›´æ–°æ—¥æœŸ: 2025-09-18*
*ç‰ˆæœ¬: 1.1.0*